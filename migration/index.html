
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.rke2.io/migration/">
      
      <link rel="icon" href="../assets/favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Migration from RKE1 to RKE2 - RKE2 - Rancher's Next Generation Kubernetes Distribution</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Work Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#migration-from-rke1-to-rke2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RKE2 - Rancher&#39;s Next Generation Kubernetes Distribution" class="md-header__button md-logo" aria-label="RKE2 - Rancher's Next Generation Kubernetes Distribution" data-md-component="logo">
      
  <img src="../assets/logo-stacked-white-rke2.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RKE2 - Rancher's Next Generation Kubernetes Distribution
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Migration from RKE1 to RKE2
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rancher/rke2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RKE2 - Rancher&#39;s Next Generation Kubernetes Distribution" class="md-nav__button md-logo" aria-label="RKE2 - Rancher's Next Generation Kubernetes Distribution" data-md-component="logo">
      
  <img src="../assets/logo-stacked-white-rke2.svg" alt="logo">

    </a>
    RKE2 - Rancher's Next Generation Kubernetes Distribution
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rancher/rke2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/requirements/" class="md-nav__link">
        Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/ha/" class="md-nav__link">
        High Availability
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          Install Options
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Install Options" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Install Options
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/install_options/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/server_config/" class="md-nav__link">
        Server Configuration Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/linux_agent_config/" class="md-nav__link">
        Agent Configuration Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/windows_agent_config/" class="md-nav__link">
        Windows Agent Configuration Reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/methods/" class="md-nav__link">
        Installation Methods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/network_options/" class="md-nav__link">
        Network Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/containerd_registry_configuration/" class="md-nav__link">
        Containerd Registry Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/airgap/" class="md-nav__link">
        Air-Gap Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/windows_airgap/" class="md-nav__link">
        Windows Air-Gap Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/linux_uninstall/" class="md-nav__link">
        Linux Uninstall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/windows_uninstall/" class="md-nav__link">
        Windows Uninstall
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Upgrades
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Upgrades" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Upgrades
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/upgrade/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/basic_upgrade/" class="md-nav__link">
        Upgrade Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/automated_upgrade/" class="md-nav__link">
        Automated Upgrades
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/about_hardened_images/" class="md-nav__link">
        About Hardened Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/hardening_guide/" class="md-nav__link">
        CIS Hardening Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/cis_self_assessment15/" class="md-nav__link">
        CIS 1.5 Self-Assessment Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/cis_self_assessment16/" class="md-nav__link">
        CIS 1.6 Self-Assessment Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/fips_support/" class="md-nav__link">
        FIPS 140-2 Enablement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/policies/" class="md-nav__link">
        Default Policy Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/selinux/" class="md-nav__link">
        SELinux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/secrets_encryption/" class="md-nav__link">
        Secrets Encryption
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/architecture/" class="md-nav__link">
        Anatomy of a Next Generation Kubernetes Distribution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cluster_access/" class="md-nav__link">
        Cluster Access
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../backup_restore/" class="md-nav__link">
        Etcd Backup and Restore
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../networking/" class="md-nav__link">
        Networking
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../helm/" class="md-nav__link">
        Helm Integration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        Advanced Options and Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../subcommands/" class="md-nav__link">
        Subcommands
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../known_issues/" class="md-nav__link">
        Known Issues and Limitations
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introducing-migration-agent" class="md-nav__link">
    Introducing Migration Agent
  </a>
  
    <nav class="md-nav" aria-label="Introducing Migration Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-configuration" class="md-nav__link">
    Cluster Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addons-migration" class="md-nav__link">
    Addons Migration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-addons-configuration-migration" class="md-nav__link">
    Cluster Addons Configuration Migration
  </a>
  
    <nav class="md-nav" aria-label="Cluster Addons Configuration Migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coredns-configuration" class="md-nav__link">
    CoreDNS Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics-server-configuration" class="md-nav__link">
    Metrics Server Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress-nginx-configuration" class="md-nav__link">
    Ingress Nginx Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-provider-support" class="md-nav__link">
    Cloud Provider Support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#private-registry-support" class="md-nav__link">
    Private Registry Support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cni-configuration-migration" class="md-nav__link">
    CNI Configuration Migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/rancher/rke2/edit/master/docs/migration.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="migration-from-rke1-to-rke2">Migration from RKE1 to RKE2<a class="headerlink" href="#migration-from-rke1-to-rke2" title="Permanent link">&para;</a></h1>
<p>In order to migrate from Rancher Kubernetes Engine (RKE1) to RKE2, you need two things:</p>
<ul>
<li>ETCD data directory</li>
<li>Cluster CA certificates</li>
</ul>
<p>Both can be found when you take a RKE1 snapshot, as the RKE1 snapshot archive contains two things: an etcd snapshot, and <code>.rkestate</code> of your cluster.</p>
<h2 id="introducing-migration-agent">Introducing Migration Agent<a class="headerlink" href="#introducing-migration-agent" title="Permanent link">&para;</a></h2>
<p>migration-agent is a tool that lays the groundwork for RKE1 nodes to move to RKE2 nodes. It accomplishes this in two main steps:</p>
<ul>
<li>Restore the etcd snapshot on etcd nodes to the RKE2 etcd db data directory.</li>
<li>Copy the CA certs and service account token key from <code>.rkestate</code> file to RKE2 data directory.</li>
</ul>
<p>This tool runs on RKE1 nodes before running RKE2.</p>
<h3 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>To run the migration you need to take a snapshot first on rke1 nodes:</p>
<div class="highlight"><pre><span></span><code>rke etcd snapshot-save --s3 --name rke1snapshot --access-key &lt;access-key&gt; --secret-key &lt;secret-key&gt; --region &lt;region&gt; --folder &lt;folder&gt; --bucket-name &lt;bucket name&gt;
</code></pre></div>
</li>
</ol>
<p>For more information, please refer to the RKE1 <a href="https://rancher.com/docs/rke/latest/en/etcd-snapshots/one-time-snapshots/">official documentation</a></p>
<ol>
<li>
<p>Now you can either run migration agent directly on the node, or use the following <a href="https://github.com/rancher/migration-agent/blob/master/deploy/daemonset.yaml">manifest</a> to deploy migration-agent as a daemonset on the RKE1 cluster. Before you apply the manifest file, you need to edit the file to include the information about the s3 snapshot of RKE1:
    <div class="highlight"><pre><span></span><code>command:
- &quot;sh&quot;
- &quot;-c&quot;
- &quot;migration-agent --s3-region &lt;region&gt; --s3-bucket &lt;s3 bucket&gt; --s3-folder &lt;s3 folder&gt; --s3-access-key &lt;access-key&gt; --s3-secret-key &lt;secret-key&gt;  --snapshot rke1db.zip &amp;&amp; sleep 9223372036854775807&quot;
</code></pre></div></p>
</li>
<li>
<p>After running the tool you should see the following paths have been created on control-plane and etcd nodes:</p>
<div class="highlight"><pre><span></span><code>/etc/rancher/rke2/config.yaml.d/10-migration.yaml
/var/lib/rancher/rke2/server/
/var/lib/rancher/rke2/server/db/
/var/lib/rancher/rke2/server/manifests/
/var/lib/rancher/rke2/server/tls/
/var/lib/rancher/rke2/server/cred
</code></pre></div>
</li>
<li>
<p>The next step is stop docker containers of rke1:</p>
<div class="highlight"><pre><span></span><code>systemctl disable docker
systemctl stop docker
</code></pre></div>
</li>
<li>
<p>The last step is to install and run rke2 server or agent depend on the type of the node:</p>
<div class="highlight"><pre><span></span><code>curl -sfL https://get.rke2.io | sh -
systemctl start rke2-server
systemctl enable rke2-server
</code></pre></div>
</li>
</ol>
<h3 id="cluster-configuration">Cluster Configuration<a class="headerlink" href="#cluster-configuration" title="Permanent link">&para;</a></h3>
<p>One of the functions of the migration-agent is to copy the cluster configuration from the rkestate file to <code>/etc/rancher/rke2/config.yaml.d/10-migration.yaml</code>, this includes:</p>
<ul>
<li>Cluster CIDR</li>
<li>Service CIDR</li>
<li>Service Node Port Range</li>
<li>Cluster DNS</li>
<li>Cluster Domain</li>
<li>Extra API Args</li>
<li>Extra Scheduler Args</li>
<li>Extra Controller Manager Args</li>
</ul>
<h3 id="addons-migration">Addons Migration<a class="headerlink" href="#addons-migration" title="Permanent link">&para;</a></h3>
<p>RKE2 deploys addons as helm charts, so migration-agent creates a manifest that deletes the old RKE1 addons and let RKE2 deploys addons as Helm charts.</p>
<h3 id="cluster-addons-configuration-migration">Cluster Addons Configuration Migration<a class="headerlink" href="#cluster-addons-configuration-migration" title="Permanent link">&para;</a></h3>
<p>One of the migration-agent features is migrating all configuration for the cluster addons to rke2, this includes:</p>
<ul>
<li>CoreDNS configuration</li>
<li>Metrics-Server configuration</li>
<li>Ingress nginx configuration </li>
</ul>
<h4 id="coredns-configuration">CoreDNS Configuration<a class="headerlink" href="#coredns-configuration" title="Permanent link">&para;</a></h4>
<p>RKE1 adds several configuration options for CoreDNS, migration-agent makes sure that these configs are migrated to a HelmchartConfig which will be used to configure the CoreDNS helmChart:</p>
<table>
<thead>
<tr>
<th>CoreDNS Optinos</th>
</tr>
</thead>
<tbody>
<tr>
<td>PriorityClassName</td>
</tr>
<tr>
<td>NodeSelector</td>
</tr>
<tr>
<td>RollingUpdate</td>
</tr>
<tr>
<td>Tolerations</td>
</tr>
<tr>
<td>AutoScalerConfig.Enabled</td>
</tr>
<tr>
<td>AutoScalerConfig.PriorityClassName</td>
</tr>
<tr>
<td>AutoScalerConfig.Min</td>
</tr>
<tr>
<td>AutoScalerConfig.Max</td>
</tr>
<tr>
<td>AutoScalerConfig.CoresPerReplica</td>
</tr>
<tr>
<td>utoScalerConfig.NodesPerReplica</td>
</tr>
<tr>
<td>AutoScalerConfig.PreventSinglePointFailure</td>
</tr>
</tbody>
</table>
<h4 id="metrics-server-configuration">Metrics Server Configuration<a class="headerlink" href="#metrics-server-configuration" title="Permanent link">&para;</a></h4>
<p>migration-agent also does the same for Metrics Server</p>
<table>
<thead>
<tr>
<th align="center">Metrics Server Options</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">PriorityClassName</td>
</tr>
<tr>
<td align="center">NodeSelector</td>
</tr>
<tr>
<td align="center">RBAC</td>
</tr>
<tr>
<td align="center">Tolerations</td>
</tr>
</tbody>
</table>
<h4 id="ingress-nginx-configuration">Ingress Nginx Configuration<a class="headerlink" href="#ingress-nginx-configuration" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th align="center">Nginx Ingress Config</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ConfigMap</td>
</tr>
<tr>
<td align="center">NodeSelector</td>
</tr>
<tr>
<td align="center">ExtraArgs</td>
</tr>
<tr>
<td align="center">ExtraEnvs</td>
</tr>
<tr>
<td align="center">ExtraVolumes</td>
</tr>
<tr>
<td align="center">ExtraVolumeMounts</td>
</tr>
<tr>
<td align="center">Tolerations</td>
</tr>
<tr>
<td align="center">DNSPolicy</td>
</tr>
<tr>
<td align="center">HTTPPort</td>
</tr>
<tr>
<td align="center">HTTPSPort</td>
</tr>
<tr>
<td align="center">PriorityClassName</td>
</tr>
<tr>
<td align="center">DefaultBackendConfig</td>
</tr>
</tbody>
</table>
<h3 id="cloud-provider-support">Cloud Provider Support<a class="headerlink" href="#cloud-provider-support" title="Permanent link">&para;</a></h3>
<p>migration-agent is able to migrate cloud provider configuration, this happens by copying the rke1 config file to the rke2 configuration directory and then passes down flags to RKE2 to include the name and path of cloud provider config:
    <div class="highlight"><pre><span></span><code>--cloud-provider-config
--cloud-provider-name
</code></pre></div></p>
<h3 id="private-registry-support">Private Registry Support<a class="headerlink" href="#private-registry-support" title="Permanent link">&para;</a></h3>
<p>The agent also adds the ability to migrate private registry configuration, this happens by copying the private registries configured in the cluster.yaml file in rke1. Unfortunately RKE1 lacks the feature of passing TLS configuration to private registries and depends on Docker TLS configuration manually on each node, so to account for that migration-agent supports a flag --registry which Configure private registry TLS paths, syntax should be <code>&lt;registry url&gt;,&lt;ca cert path&gt;,&lt;cert path&gt;,&lt;key path&gt;</code>.</p>
<h3 id="cni-configuration-migration">CNI Configuration Migration<a class="headerlink" href="#cni-configuration-migration" title="Permanent link">&para;</a></h3>
<p>RKE1 and RKE2 both support Calico and Canal CNI, so migration-agent will be able to migrate the CNI only if Canal or Calico is used.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>